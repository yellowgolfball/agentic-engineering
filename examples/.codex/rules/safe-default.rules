# Codex .rules files use Starlark. Rules match argv prefixes, not raw shell strings.
# These rules are for commands running outside the sandbox.

prefix_rule(
  pattern=["git", "status"],
  decision="allow",
  match=[["git", "status"]],
)

prefix_rule(
  pattern=["git", "diff"],
  decision="allow",
  match=[["git", "diff"], ["git", "diff", "--stat"]],
)

prefix_rule(
  pattern=["rg"],
  decision="allow",
  match=[["rg", "--files"], ["rg", "TODO", "src"]],
)

# Prompt for common maintenance commands that can change files.
prefix_rule(
  pattern=["npm", "run", ["lint", "test", "docs:list"]],
  decision="prompt",
  match=[["npm", "run", "lint"]],
  not_match=[["npm", "run", "build"]],
)

# Forbid obviously destructive commands.
prefix_rule(
  pattern=["rm", "-rf"],
  decision="forbid",
  match=[["rm", "-rf", "/"]],
)

# Windows guardrails: block cmd /c and common destructive built-ins.
prefix_rule(
  pattern=["cmd"],
  decision="forbid",
  match=[["cmd", "/c"]],
)

prefix_rule(
  pattern=["cmd.exe"],
  decision="forbid",
  match=[["cmd.exe", "/c"]],
)

prefix_rule(
  pattern=["rmdir"],
  decision="forbid",
  match=[["rmdir", "/s", "/q"]],
)

prefix_rule(
  pattern=["rd"],
  decision="forbid",
  match=[["rd", "/s", "/q"]],
)

prefix_rule(
  pattern=["del"],
  decision="forbid",
  match=[["del"]],
)

prefix_rule(
  pattern=["erase"],
  decision="forbid",
  match=[["erase"]],
)
